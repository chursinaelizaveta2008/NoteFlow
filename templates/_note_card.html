<!-- templates/_note_card.html -->
<div class="card note-card h-100 {% if note.is_pinned %}pinned{% endif %}">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title mb-0">
                {% if note.is_pinned %}
                    <i class="bi bi-pin-angle-fill text-warning"></i>
                {% endif %}
                {{ note.title }}
            </h5>
            
            <div class="dropdown">
                <button class="btn btn-sm btn-light" type="button" 
                        data-bs-toggle="dropdown">
                    <i class="bi bi-three-dots"></i>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item" 
                           href="{{ url_for('edit_note', note_id=note.id) }}">
                            <i class="bi bi-pencil"></i> Редактировать
                        </a>
                    </li>
                    <li>
                        <form method="POST" 
                              action="{{ url_for('pin_note', note_id=note.id) }}">
                            <button type="submit" class="dropdown-item">
                                {% if note.is_pinned %}
                                    <i class="bi bi-pin-angle"></i> Открепить
                                {% else %}
                                    <i class="bi bi-pin-angle-fill"></i> Закрепить
                                {% endif %}
                            </button>
                        </form>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <form method="POST" 
                              action="{{ url_for('delete_note', note_id=note.id) }}"
                              onsubmit="return confirm('Удалить заметку «{{ note.title }}»?')">
                            <button type="submit" class="dropdown-item text-danger">
                                <i class="bi bi-trash"></i> Удалить
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Категория -->
        {% if note.category_id %}
        <div class="mb-2">
            {% set category = Category.query.get(note.category_id) %}
            {% if category %}
            <span class="badge bg-{{ category.color }}">
                {{ category.name }}
            </span>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Краткое содержание -->
        <p class="card-text text-muted">
            {% if note.content %}
                {{ note.content[:100] }}
                {% if note.content|length > 100 %}...{% endif %}
            {% else %}
                <span class="fst-italic">Нет содержания</span>
            {% endif %}
        </p>
        
        <!-- Теги -->
        {% if note.tags %}
        <div class="mt-2">
            {% for tag in note.tags.split(',') %}
                {% if tag.strip() %}
                <span class="badge bg-secondary me-1">{{ tag.strip() }}</span>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="card-footer bg-transparent">
        <div class="d-flex justify-content-between">
            <small class="text-muted">
                <i class="bi bi-clock"></i>
                {{ note.updated_at.strftime('%d.%m.%Y %H:%M') }}
            </small>
            <a href="{{ url_for('view_note', note_id=note.id) }}" 
               class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i> Просмотр
            </a>
        </div>
    </div>
</div>
